.. _ad_fmclidar1_ebz:

AD-FMCLIDAR1-EBZ HDL project (OBSOLETE)
================================================================================

.. warning::

   The support for :git-hdl:`AD-FMCLIDAR1-EBZ <hdl_2019_r1:projects/ad_fmclidar1_ebz>`
   HDL project has been discontinued, the latest release branch where it can be found
   is ``hdl_2019_r1``. This page is left for legacy purposes only.

Overview
-------------------------------------------------------------------------------

The :adi:`AD-FMCLIDAR1-EBZ <AD-FMCLIDAR1-EBZ>` is a prototyping platform for
LiDAR applications that can be used on FPGA development boards enabled with FMC
HPC connector and JESD204B support capability. It offers developers a
working-out-of-box platform that can be used for developing software and
algorithms for a broad range of applications.

The full system hardware includes Data Acquisition(DAQ) Board, Laser Transmitter
Board, and the AFE Receiver Board.

Supported boards
-------------------------------------------------------------------------------

- :adi:`AD-FMCLIDAR1-EBZ <AD-FMCLIDAR1-EBZ>`

Supported carriers
-------------------------------------------------------------------------------

- :xilinx: `ZC706 <https://www.xilinx.com/products/boards-and-kits/ek-z7-zc706-g.html>` on FMC HPC
- :xilinx: `ZCU102 <https://www.xilinx.com/products/boards-and-kits/ek-u1-zcu102-es2-g.html>` on on FMC HPC0
- :intel: `A10SoC <https://www.altera.com/products/boards_and_kits/dev-kits/altera/arria-10-soc-development-kit.html>` on FMC HPC

The Arria10SOC carrier requires a hardware rework to function correctly. The rework
connects FMC_A header pins directly to the FPGA so that they can be accessed by the fabric.

Changes required:

REMOVE: R575, R576, R621, R633, R612, R613

POPULATE: R574, R577, R620, R632, R610, R611

Block design
-------------------------------------------------------------------------------

Block diagram
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The main scope of the HDL design is to provide all the required digital
interfaces for the data acquisition board of the prototyping system.

The following block diagram presents the simplified system architecture:

.. image:: ad_fmlidar1_ebz.svg
   :width: 800
   :align: center
   :alt: AD-FMCLIDAR1-EBZ block diagram


AXI Laser Driver IP
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The axi_laser_driver IP is responsible to generate a narrow pulse for the laser
driver circuit, to control the TIA channel selection on the analog front end (AFE)
board, and to synchronize the data acquisition to the generated pulses.

More information about the IP can be found here:
`AXI_Laser_Driver_IP <https://wiki.analog.com/resources/fpga/docs/axi_laser_driver>`.

Control interfaces
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

============================ ============ ============================================================================================
Name                         Type         Details
============================ ============ ============================================================================================
adc_fd*                      GPIO         Monitors the AD9094 Fast detect output lines
adc_pwdn                     GPIO         Controls the AD9094 Power-Down input line
spi_adc_*                    4-wire SPI   AD9094 configuration interface
spi_vco_*                    3-wire SPI   ADF436-7 configuration interface
spi_clkgen_*                 4-wire SPI   AD9528 configuration interface
laser_driver_p\n             LVDS output  It controls the laser driver circuit, it is generated by the axi_laser_driver IP instance
laser_gpio[13:0]             GPIO         Unused GPIO line on the lase board
tia_chsel[7:0]               CMOS output  TIA channel selection lines, it is controlled by the axi_laser_driver instance
afe_dac_sda\scl\load\clr_n   I2C/GPIO     AD5627 configuration interface
rx_ref_clk_p\n               LVDS         JESD204B reference clock for the high-speed gigabit transceivers; runs at 250MHz
rx_device_clk_p\n            LVDS         JESD204B device clock for the transport layer and additional data processing; runs at 250MHz
rx_data_p\n[3:0]             CML          JESD204B high-speed serial lanes; runs at 10Gbps
rx_sync_p\n[1:0]             LVDS         JESD204B SYNC signals for interface synchronization
rx_sysref_p\n                LVDS         JESD204B SYSREF signal for deterministic latency
============================ ============ ============================================================================================

JESD204B interface
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The JESD204B interface runs in Subclass 1 mode to ensure the deterministic
latency of the link. The following tables are summarizing the JESD204B important
configuration parameter and attributes.

=============================== ============ =====
Parameter name                  Abbreviation Value
=============================== ============ =====
Number of lanes                 L            4 
Number of converter             M            4
Converter resolution            NP           8
Total number of Bits per Sample NP           8
Samples per frame               S            1
Octets per frame                F            1
Frames per Multiframe           K            32
Number of control bits          CS           0
=============================== ============ =====

================== =======
Rates and Clocks   Value 
================== =======
Sample rate        1 GSPS
Lane rate          10 Gbps
GT reference clock 250 MHz
Device clock       250 MHz
================== =======


Known issues
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The Lidar boards do not power up 

**Problem:** The Lidar boards do not power up because the PG_C2M pull-up
resistor value on the carrier (Arria 10) is too high. 

**Solution:** On Arria 10 - place a 4k7 ohms resistor in parallel with R5517.

**Note:** 

1. The PG_C2M can no longer be software controlled. As soon as there is an
auxiliary 3V3 on the carrier, the Lidar platform receives the power up command.

2. This problem only affects Lidar Rev B.

Building the HDL project
-------------------------------------------------------------------------------

The design is built upon ADI's generic HDL reference design framework.
ADI distributed the bit/elf files of this project as part of the
:dokuwiki:`ADI Kuiper Linux <resources/tools-software/linux-software/kuiper-linux>`
until the 2019_R1 release. The prebuilt files can be found in the previous link.
Afterwards, it was discontinued.

But, if you want to build the sources, ADI makes them available on the
:git-hdl:`HDL repository </>`. To get the source you must
`clone <https://git-scm.com/book/en/v2/Git-Basics-Getting-a-Git-Repository>`__
the HDL repository and checkout the last release branch where this project
still exists, ``hdl_2019_r1``.

Then go to the hdl/projects/ad_fmclidar1_ebz/$zc706 location and run the make
command. You can also go to the other folder for different carrier.

.. shell::

   /hdl
   $git checkout hdl_2019_r1
   $cd projects/ad_fmclidar1_ebz/zc706
   $make

A more comprehensive build guide can be found in the :ref:`build_hdl` user
guide.

Resources
-------------------------------------------------------------------------------

Parts
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Laser Board

- `3.3 V, 200 Mbps, Half-Duplex, High Speed M-LVDS Transceiver with Type 1 Receiver <https://www.analog.com/adn4691e>`
- `High Speed, Dual, 4 A MOSFET Driver, non-inverting A/B input pins, 9.5V < VIN < 18V <https://www.analog.com/adp3634>`
- `Ultralow Noise Drivers for Low Voltage ADCs <https://www.analog.com/ada4930-1>`

DAQ Board

- `8-Bit, 1 GSPS, JESD204B, Quad Analog-to-Digital Converter <https://www.analog.com/ad9094>`
- `Integrated Synthesizer and VCO <https://www.analog.com/adf4360-7>`
- `JESD204B/JESD204C Clock Generator with 14 LVDS/HSTL Outputs <https://www.analog.com/ad9528>`
- `1.2 A, Ultralow Noise, High PSRR, Fixed Output, RF Linear Regulator <https://www.analog.com/adp7156>`
- `2 A, Ultralow Noise, High PSRR, Adjustable Output, RF Linear Regulator <https://www.analog.com/adp7159>`

AFE Board

- `Four-Channel Multiplexed Transimpedance Amplifier with Output Multiplexing <https://www.analog.com/ltc6561>`
- `Low Power Selectable Gain Differential ADC Driver <https://www.analog.com/ada4950-1>`
- `Dual 3.2MHz, 0.8V/μs Low Power, Over-The-Top Precision Op Amp <https://www.analog.com/lt6016>`
- `Micropower, Precision, Auto Qualified 2.5V Voltage Reference <https://www.analog.com/adr3525>`
- `Low IQ Boost/SEPIC/Flyback/Inverting Converter with 0.5A, 140V Switch <https://www.analog.com/lt8331>`


Systems related
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- :dokuwiki:`[Wiki] AD-FMCLIDAR1-EBZ <resources/eval/user-guides/ad-fmclidar1-ebz>`

Hardware related
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- Product datasheets: :adi:`AD-FMCLIDAR1-EBZ`

HDL related
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- :git-hdl:`AD-FMCLIDAR1-EBZ HDL project source code <hdl_2019_r1:projects/ad_fmclidar1_ebz>`

.. list-table::
   :widths: 30 35 35
   :header-rows: 1

   * - IP name
     - Source code link
     - Documentation link
   * - AXI_AD9739A
     - :git-hdl:`hdl_2021_r2:library/axi_ad9739a`
     - —
   * - AXI_DMAC
     - :git-hdl:`hdl_2021_r2:library/axi_dmac`
     - :ref:`axi_dmac`
   * - AXI_CLKGEN
     - :git-hdl:`hdl_2021_r2:library/axi_clkgen`
     - :ref:`axi_clkgen`
   * - AXI_SYSID
     - :git-hdl:`hdl_2021_r2:library/axi_sysid`
     - :ref:`axi_sysid`
   * - AXI_HDMI_TX
     - :git-hdl:`hdl_2021_r2:library/axi_hdmi_tx`
     - :ref:`axi_hdmi_tx`
   * - AXI_SPDIF_TX
     - :git-hdl:`hdl_2021_r2:library/axi_spdif_tx`
     - 	—
   * - SYSID_ROM
     - :git-hdl:`hdl_2021_r2:library/sysid_rom`
     - :ref:`axi_sysid`
   * - UTIL_CPACK2
     - :git-hdl:`library/util_cpack2`
     - :ref:`util_cpack2`
   * - JESD204_RX
     - :git-hdl:`library/jesd204/jesd204_rx`
     - :ref:`jesd204_rx`
   * - AXI_JESD204_RX
     - :git-hdl:`library/jesd204/axi_jesd204_rx`
     - :ref:`axi_jesd204_rx`
   * - AD_IP_JESD204_TPL_ADC
     - :git-hdl:`library/jesd204/ad_ip_jesd204_tpl_adc`
     - :ref:`ad_ip_jesd204_tpl_adc`

Software related
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- :git-linux:`AXI Laser Driver Linux driver <https://wiki.analog.com/resources/fpga/docs/axi_laser_driver>`

.. include:: ../common/more_information.rst

.. include:: ../common/support.rst
